# –ß–∞—Å—Ç—å 5

## Chapter 7. Entering Chroot and Building Additional Temporary Tools

–ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥ $LFS —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —á—Ç–æ–±—ã –æ–Ω –æ—Ç–≤–µ—á–∞–ª —Ç—Ä–µ–±–≤–∞–Ω–∏–µ–º –∫–∞—Ç–∞–ª–æ–≥–∞ / –æ–±—ã—á–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã linux. –ù–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∫–∞—Ç–∞–ª–æ–≥–∏ /dev, /proc, /sys –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∏—Ö –∫–∞–∫ –∫–∞—Ç–∞–ª–æ–≥–∏ –Ω–∞—à–µ–π —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã.

–î–∞–ª–µ–µ –º—ã –±—É–¥–µ–º —Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è root, –ø–æ—ç—Ç–æ–º—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —É —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–æ–ø–∏—Å–∞–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è $LFS. –û–ø—Ä–µ–¥–µ–ª–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é $LFS –≤ —Ñ–∞–π–ª–µ .bashrc –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è root –∏–ª–∏ –≤ —Ñ–∞–π–ª–µ /etc/profile
```
export $LFS=/mnt/lfs
```
export - –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –≤ –¥–æ—á–µ—Ä–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã  
–ú–µ–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –Ω–∞ root
```
chown -R root:root $LFS/{usr,lib,var,etc,bin,sbin,tools}
case $(uname -m) in
x86_64) chown -R root:root $LFS/lib64 ;;
esac
```
### üî∑ –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã

–°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º
```
mkdir -pv $LFS/{dev,proc,sys,run}
.................................
mkdir: created directory '/mnt/lfs/dev'
mkdir: created directory '/mnt/lfs/proc'
mkdir: created directory '/mnt/lfs/sys'
mkdir: created directory '/mnt/lfs/run'
```
### üî∑ –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤

–°–æ–∑–¥–∞–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ console –∏ null
```
mknod -m 600 $LFS/dev/console c 5 1
mknod -m 666 $LFS/dev/null c 1 3
....................................
# ls -l $LFS/dev/
total 0
crw------- 1 root root 5, 1 Feb 20 10:23 console
crw-rw-rw- 1 root root 1, 3 Feb 20 10:24 null
```

c 5 1 - –º–∞–∂–æ—Ä –∏ –º–∏–Ω–æ—Ä —á–∏—Å–ª–∞. 5 - —Å –¥—Ä–∞–π–≤–µ—Ä–æ–º –∫–∞–∫–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –±—É–¥–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª, 1 - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ –Ω–∞—à–∏—Ö –º–∞–∂–æ—Ä–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤ –º–æ–∂–Ω–æ –≤ —Ñ–∞–π–ª–µ /proc/devices
```
cat /proc/devices
.....................
Character devices:                                                                                                                                                                           
  1 mem                                                                                                                                                                                      
  4 /dev/vc/0                                                                                                                                                                                
  4 tty                                                                                                                                                                                      
  4 ttyS                                                                                                                                                                                     
  5 /dev/tty
.....................
```
–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–∞–∂–æ—Ä—ã –∏ –º–∏–Ω–æ—Ä—ã –¥–ª—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–∏–º–≤–æ–ª—å–Ω—ã—Ö —É—Ç—Å—Ä–æ–π—Å—Ç–≤ –º–æ–∂–Ω–æ —Ç–∞–∫
```
ls -l /sys/dev/char
```
### üî∑ –°–≤—è–∑—ã–≤–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥ /dev —Ö–æ—Å—Ç–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã —Å –∫–∞—Ç–∞–ª–æ–≥–æ–º /dev –±—É–¥—É—â–µ–≥–æ chroot
–ù–µ–±–æ–ª—å—à–æ–µ –æ—Ç—Å—Ç—É–ø–ª–µ–Ω–∏–µ: –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–º —Å–∏—Ç—É–∞—Ü–∏—é - —É –Ω–∞—Å –µ—Å—Ç—å –∫–∞—Ç–∞–ª–æ–≥ —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º, –∏ –≤ —ç—Ç–æ—Ç –∫–∞—Ç–∞–ª–æ–≥ –ø—Ä–∏–º—Ä–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –∫–∞–∫–∞–æ–µ-—Ç–æ –¥–∏—Å–∫–æ–≤–æ–µ —É—Ç—Å—Ä–æ–π—Å—Ç–≤–æ. –ö–∞–∫ —É–≤–∏–¥–µ—Ç—å –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞—Ç–∞–ª–æ–≥–∞ –±–µ–∑ –æ—Ç–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞? –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–ø—Ü–∏—è bind –≤ –∫–æ–º–∞–Ω–¥–µ mount. –ù–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç root –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä—É–µ–º –Ω–∞—à–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤ –∫–∞—Ç–∞–ª–æ–≥ /bind, –≤ –∫–æ—Ç–æ—Ä–æ–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞–¥–∏–º —Ñ–∞–π–ª—ã
```
mkdir /bind
cd /bind
touch file{1..10}
ls /bind
.....................................................................
file1  file10  file2  file3  file4  file5  file6  file7  file8  file9
......................................................................
cd
umount /mnt/lfs
mount /dev/mapper/vg0-lfs /bind
ls /bind
...........................................................................................
bin  dev  etc  lib  lib64  lost+found  proc  run  sbin  sources  sys  tmp  tools  usr  var
```
–í–∏–¥–∏–º, —á—Ç–æ —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏ /bind —Å–æ–æ—Ç–≤–µ—Ç—Å–≤—É–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É –ø–∞–ø–∫–∏ $LFS.  
–°–æ–∑–¥–∞–¥–∏–º –ø–∞–ø–∫—É /root/temp –∏ –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä—É–µ–º –≤ –Ω–µ–µ —Ö–æ—Å—Ç–æ–≤—É—é —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É —Å –æ–ø—Ü–∏–µ–π bind  
```
mount --bind / /root/temp
```
–¢–µ–ø–µ—Ä—å –ø–æ—Å–º–æ—Ç—Ä–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏ /root/temp/bind
```
# ls /root/temp/bind
......................................................................
file1  file10  file2  file3  file4  file5  file6  file7  file8  file9
```
–í–∏–¥–∏–º –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏ /bind.  
  
–°–≤—è–∑—ã–≤–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥ —Ö–æ—Å—Ç–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã /dev —Å –∫–∞—Ç–∞–ª–æ–≥–æ–º /$LFS/dev
```
mount -v --bind /dev $LFS/dev
```
–ú–æ–Ω—Ç–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –∫–æ—Ä–Ω–µ–≤—ã–µ —Ñ–∞–π–ª–æ–≤—ã–µ —Å–∏—Å–∏—Ç–µ–º—ã
```
mount -v --bind /dev/pts $LFS/dev/pts
mount -vt proc proc $LFS/proc
mount -vt sysfs sysfs $LFS/sys
mount -vt tmpfs tmpfs $LFS/run
```
–í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö /dev/shm –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫—É—é —Å—Å—ã–ª–∫—É –Ω–∞ /run/shm. –í—Ä–µ–º–µ–Ω–Ω–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–∂–µ –±—ã–ª–∞ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤—ã—à–µ, –ø–æ—ç—Ç–æ–º—É –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ª–∏—à—å —Å–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
```
if [ -h $LFS/dev/shm ]; then
   mkdir -pv $LFS/$(readlink $LFS/dev/shm)
fi
```
### üî∑ –ó–∞—Ö–æ–¥–∏–º –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–µ chroot
```
chroot "$LFS" /usr/bin/env -i HOME=/root TERM="$TERM" PS1='(lfs chroot) \u:\w\$ ' PATH=/usr/bin:/usr/sbin /bin/bash --login +h
```
/usr/bin/env - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
PS1='(lfs chroot) - –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∞—è —Å—Ç—Ä–æ–∫—É –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
