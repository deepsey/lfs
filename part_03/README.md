#  –ß–∞—Å—Ç—å 3 
  
SBU - Standrad Build Unit, —Å–≤–æ–µ–≥–æ —Ä–æ–¥–∞ –∏–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏—Ç–æ–π –∏–ª–∏ –∏–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã. –ó–∞ –æ—Ü–µ–Ω–æ—á–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –±–µ—Ä–µ—Ç—Å—è –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –ø–∞–∫–µ—Ç–∞ binutils. –ò–º–µ–Ω–Ω–æ —Å –Ω–µ–≥–æ –∏ –Ω–∞—á–∏–Ω–∞–µ–º –∫–æ–º–ø–∏–ª—è—Ü–∏—é.  

 ## Chapter 5. Compiling a Cross-Toolchain  
### üî∑ Binutils-2.38  
–†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –∞—Ä—Ö–∏–≤ –≤ –ø–∞–ø–∫–µ sources
```
tar xvf binutils-2.38.tar.xz
````
–ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –∫–∞—Ç–∞–ª–æ–≥ /mnt/lfs/sources/binutils-2.38  
–ü—Ä–∏–º–µ–Ω—è–µ–º –ø–∞—Ç—á –¥–ª—è –ø–∞–∫–µ—Ç–∞
```
patch -Np1 < ../binutils-2.38-lto_fix-1.patch
```
-N - –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ç—á–∞, –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –∫–∞–∫–∞—è-—Ç–æ –æ—à–∏–±–∫–∞, —Å —Ç–æ–≥–æ –∂–µ –º–µ—Å—Ç–∞  
p1 - —É–±—Ä–∞—Ç—å —á–∞—Å—Ç—å –ø—É—Ç–∏ –æ—Ç –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞  

–ü–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—Å—è, —á—Ç–æ –Ω–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ –æ—à–∏–±–æ–∫
  ```
  lfs:/mnt/lfs/sources/binutils-2.38$ echo $?  
  0
  ```
–°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é build –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –Ω–µ–µ
```
mkdir -v build
cd build
```
–ó–∞–ø—É—Å–∫–∞–µ–º configure –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Makefile
```
../configure --prefix=$LFS/tools --with-sysroot=$LFS --target=$LFS_TGT --disable-nls --disable-werror
```
--prefix - –∫—É–¥–∞ –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–∞–∫–µ—Ç  
--with-sysroot - sysroot –¥–ª—è –ø–∞–∫–µ—Ç–∞ –±—É–¥–µ—Ç /mnt/lfs  
--disable-werror - –æ—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è  

–ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏ –Ω–∞–ª–∏—á–∏–µ Makefile. Mekefile - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ —è–∑—ã–∫–∞ make, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —á—Ç–æ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å —É—Ç–∏–ª–∏—Ç–µ make. –¢.–µ. make –Ω–µ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç, –∞ –ø—Ä–æ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã –∏–∑ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞, –Ω–µ –±–æ–ª–µ–µ —Ç–æ–≥–æ.  
–ó–∞–ø—É—Å–∫–∞–µ–º make –∏ –∏–∑–º–µ—Ä—è–µ–º –≤—Ä–µ–º—è –µ–≥–æ —Ä–∞–±–æ—Ç—ã. –ò—Å–ø–æ–ª—å–∑—É–µ–º 8 –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ –¥–ª—è –Ω–∞—à–µ–π –º–∞—à–∏–Ω—ã
```
time make -j8  
............................  
real    0m23.197s  
user    1m27.901s  
sys     0m11.603s  
lfs:/mnt/lfs/sources/binutils-2.38/build$ echo $?  
0
```
SBU –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ = 0m23.197s  

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–∞–∫–µ—Ç
```
make install -j1  
lfs:/mnt/lfs/sources/binutils-2.38/build$ echo $?  
0
```
---
### üî∑ GCC-11.2.0 - Pass 1  
–†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –∞—Ä—Ö–∏–≤ –≤ –ø–∞–ø–∫–µ sources
```
tar xvf gcc-11.2.0.tar.xz
````
–ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –∫–∞—Ç–∞–ª–æ–≥ /mnt/lfs/sources/gcc-11.2.0  
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞–∫–µ—Ç—ã  
```
tar xvf ../mpfr-4.1.0.tar.xz  
mv -v mpfr-4.1.0 mpfr  
tar xvf ../gmp-6.2.1.tar.xz  
mv -v gmp-6.2.1 gmp  
tar xvf ../mpc-1.2.1.tar.gz  
mv -v mpc-1.2.1 mpc
```
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–º—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è 64-–±–∏—Ç–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –≤ "lib" —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç tmp.sh
```
case $(uname -m) in  
  x86_64)  
  sed -e '/m64=/s/lib64/lib/' \  
  -i.orig gcc/config/i386/t-linux64  
  ;;  
esac
```
–°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é build –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –Ω–µ–µ
```
mkdir -v build
cd build
```
–ó–∞–ø—É—Å–∫–∞–µ–º configure
```
../configure --target=$LFS_TGT --prefix=$LFS/tools --with-glibc-version=2.11 --with-sysroot=$LFS --with-newlib --without-headers --enable-initfini-array --disable-nls --disable-shared  -disable-multilib --disable-decimal-float --disable-threads --disable-libatomic --disable-libgomp  --disable-libquadmath --disable-libssp --disable-libvtv --disable-libstdcxx --enable-languages=c,c++
```
–ó–∞–ø—É—Å–∫–∞–µ–º make
```
time make -j8  
............................ 
real    2m57.347s  
user    15m55.439s  
sys     1m16.443s
```
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–∞–∫–µ—Ç
```
make install   
lfs:/mnt/lfs/sources/gcc-11.2.0/build$ echo $?  
0
```
–ü–æ—Ä–ø–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã 
```
cd ..  
cat gcc/limitx.h gcc/glimits.h gcc/limity.h > `dirname $($LFS_TGT-gcc -print-libgcc-file-name)`/install-tools/include/limits.h  
```
---
### üî∑ Linux-5.16.9 API Headers
–†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º —è–¥—Ä–æ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –µ–≥–æ –∫–∞—Ç–∞–ª–æ–≥
```
lfs:/mnt/lfs/sources$ tar xvf linux-5.16.9.tar.xz
```
–ó–∞—á–∏—â–∞–µ–º —Ç–æ, —á—Ç–æ –Ω–∞–º –Ω–µ –Ω—É–∂–Ω–æ
```
make mrproper
```
–ò–∑–≤–ª–µ–∫–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∑–∞–≥–æ–ª–æ–≤–∫–∏ —è–¥—Ä–∞, –∫–æ–ø–∏—Ä—É–µ–º –∏—Ö –≤ –Ω—É–∂–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ
```
make headers  
find usr/include -name '.*' -delete  
rm usr/include/Makefile  
cp -rv usr/include $LFS/usr
```
–•—ç–¥–µ—Ä—ã –≥–æ—Ç–æ–≤—ã.

### üî∑ Glibc-2.35
–†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ –ø–∞–∫–µ—Ç–∞ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –µ–≥–æ –∫–∞—Ç–∞–ª–æ–≥
```
tar xvf glibc-2.35.tar.xz
```
–°–æ–∑–¥–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—É—Å–∫ —Ñ–∞–π–ª–∞ tmp.sh
```
case $(uname -m) in
  i?86) ln -sfv ld-linux.so.2 $LFS/lib/ld-lsb.so.3
  ;;
  x86_64) ln -sfv ../lib/ld-linux-x86-64.so.2 $LFS/lib64
  ln -sfv ../lib/ld-linux-x86-64.so.2 $LFS/lib64/ld-lsb-x86-64.so.3
  ;;
esac  
```
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–∞—Ç—á
```
patch -Np1 < ../glibc-2.35-fhs-1.patch
```
–°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é build –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –Ω–µ–µ
```
mkdir -v build
cd build
```
–í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–¥–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```
echo "rootsbindir=/usr/sbin" > configparms
```
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º make
```
../configure --prefix=/usr --host=$LFS_TGT --build=$(../scripts/config.guess) --enable-kernel=3.2 --with-headers=$LFS/usr/include libc_cv_slibdir=/usr/lib
```
–í—ã–ø–æ–ª–Ω—è–µ–º make
```
time make -j8
.......................................
real    1m14.629s  
user    6m8.734s  
sys     1m22.353s  
```
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–∞–∫–µ—Ç —Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π DESTDIR=$LFS
```
make DESTDIR=$LFS install   
lfs:/mnt/lfs/sources/glibc-2.35/build$ echo $?  
0
```
–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è DESTDIR –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Ç–∏ –≤—Å–µ–º–∏ –ø–∞–∫–µ—Ç–∞–º–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç–∞,–Æ –∫—É–¥–∞ –ø–∞–∫–µ—Ç—ã –±—É–¥—É—Ç —É—Ç—Å–∞–Ω–æ–≤–ª–µ–Ω—ã. –ï—Å–ª–∏ –æ–Ω–∞ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞, —Ç–æ –µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ä–∞–≤–Ω–æ / (root –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è).  
–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º —Ñ–∞–π–ª ldd, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å—ã–≤–∞–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
```
sed '/RTLDLIST=/s@/usr@@g' -i $LFS/usr/bin/ldd
```
–ü—Ä–æ–≤–µ—Ä—è–µ–º, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —ç—Ç–æ –≤—Å–µ
```
echo 'int main(){}' > dummy.c  
$LFS_TGT-gcc dummy.c  
readelf -l a.out | grep '/ld-linux'  
    [Requesting program interpreter: /lib64/ld-linux-x86-64.so.2]
```
–ü–æ—Å–ª–µ–¥–Ω–Ω–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º, —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.  
–£–¥–∞–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã
```
rm -v dummy.c a.out
```
–í —Ñ–∏–Ω–∞–ª–µ —Å–æ–∑–¥–∞–µ–º —Ö—ç–¥–µ—Ä limits.h
```
$LFS/tools/libexec/gcc/$LFS_TGT/11.2.0/install-tools/mkheaders
```
–£–¥–∞–ª—è–µ–º –∫–∞—Ç–∞–ª–æ–≥ build
```
lfs:/mnt/lfs/sources/glibc-2.35$ rm -rf build/
```
---
### üî∑ GCC-11.2.0, Pass 1
–ï—Å–ª–∏ –∫–∞—Ç–∞–ª–æ–≥ /mnt/lfs/sources/gcc-11.2.0 –Ω–µ —É–¥–∞–ª—è–ª—Å—è, —Ç–æ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –Ω–µ–≥–æ –∏ —É–¥–∞–ª—è–µ–º –∫–∞—Ç–∞–ª–æ–≥ build, –∞ –∑–∞—Ç–µ–º –µ–≥–æ –∑–∞–Ω–æ–≤–æ —Å–æ–∑–¥–∞–µ–º. –ï—Å–ª–∏ –∫–∞—Ç–∞–ª–æ–≥ —É–¥–∞–ª—è–ª—Å—è, —Ç–æ –∑–∞–Ω–æ–≤–æ —Ä–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –∞—Ä—Ö–∏–≤ –∏ —Å–æ–∑–¥–∞–µ–º –≤ –∫–∞—Ç–∞–ª–æ–≥–µ gcc-11.2.0 –ø–∞–ø–∫—É build
```
mnt/lfs/sources$ tar xvf gcc-11.2.0.tar.xz  
cd gcc-11.2.0
mkdir -v build
cd build
```
–ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º libstdc++ –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
```
../libstdc++-v3/configure --host=$LFS_TGT --build=$(../config.guess) --prefix=/usr --disable-multilib --disable-nls --disable-libstdcxx-pch --with-gxx-include-dir=/tools/$LFS_TGT/include/c++/11.2.0
```
–í—ã–ø–æ–ª–Ω—è–µ–º make
```
make -j8
```
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É —Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π DESTDIR=$LFS
```
make DESTDIR=$LFS install
```

